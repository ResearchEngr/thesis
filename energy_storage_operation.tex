
\pgfplotstableread
{./ex_modelS.dat}
{\loadedtable}

\begin{figure}
 \centering
\subfigure[  Tesla Model S with Large Battery System ]{
	\begin{tikzpicture}[scale=.8]
		\begin{axis}[xlabel=$Time$ (hour), ylabel=$Prices \hspace{7px} (\frac{\mbox{\$}}{\mbox{MWh}}$)
				%,scale only axis
				%,legend pos=outer north east 
				,width=12cm
				,axis y line*=left
				,extra y ticks={-50, 0, 50,100,150}
				,extra tick style={grid=major}
				,xmin=1,xmax=24
				,title=\mbox{\textbf{ Real Time Storage Operation }} ]

	
	\addplot+[opacity=.5, color=red,smooth,mark=o,line width=2pt] table[x=time, y=n0,mark=square] {./data/lmp_feb_3_2010.dat};
	\addlegendentry{Day Ahead Prices}
 	\addplot+[opacity=.5, smooth,solid,color=blue,mark=o,line width=2pt] table[x=time, y=n1] {./data/lmp_feb_3_2010.dat};
	\addlegendentry{Real Time Prices}
\foreach \i in {2,...,15}
{
 	\addplot+[opacity=.25, smooth,solid,color=black,mark=o] table[x=time, y=n\i] {./data/lmp_feb_3_2010.dat};
%	\addlegendentryexpanded{$n\i$}
}

		\end{axis}	
		
		\begin{axis}[xlabel=$t$ (hour), ylabel=$Energy \hspace{4px}$ (MW)
				%,ybar stacked
				%,scale only axis
				, const plot
				, stack plots=y
				, area style
				,width=12cm
				, axis y line=right
				, axis x line=none
				,xmin=1,xmax=24 
				,ymin=0,ymax=100
				,legend style={
					area legend,
					at={(0.5,-0.15)},
					anchor=north,
					legend columns=-1}]

 	\addplot+[%solid,color=black,
			%pattern=flexible hatch,
			%pattern color = cyan
			opacity=.75
			] table[x=time, y=e_r] from \loadedtable \closedcycle;
 	\addplot+[%color=red,
			%pattern=flexible hatch,
			%pattern color = red
			opacity=.75
			] table[x=time, y=s_r] from \loadedtable \closedcycle;
 	\addplot+[%color=red,
			%pattern=flexible hatch,
			%pattern color = red
			opacity=.75
			] table[x=time, y=d_r] from \loadedtable \closedcycle;
 	\addplot+[%color=red,
			%pattern=flexible hatch,
			%pattern color = red
			opacity=.75
			] table[x=time, y=t_r] from \loadedtable \closedcycle;
	\legend{Energy Level, Energy Stored, Energy Dispatched, Travel Energy}
 %	\addplot+[ybar, solid,color=black,
%			pattern=flexible hatch,
%			pattern color = green] table[x=time, y=sr] {./feb_ex_modelS.dat};
%	\addplot+ table[x=time, y=n0] { feb_ex_modelS.dat};		

		\end{axis}


	\end{tikzpicture}
}


\subfigure[  Nissan Leaf ]{
	\begin{tikzpicture}[scale=.8]
		\begin{axis}[xlabel=$Time$ (hour), ylabel=$Prices \hspace{7px} (\frac{\mbox{\$}}{\mbox{MWh}}$)
				%,scale only axis
				%,legend pos=outer north east 
				,width=12cm
				,axis y line*=left
				,extra y ticks={-50, 0, 50, 100,150}
				,extra tick style={grid=major}
				,xmin=1,xmax=24
				,title=\mbox{\textbf{ Real Time Storage Operation }} ]

	
	\addplot+[opacity=.5, color=red,smooth,mark=o,line width=2pt] table[x=time, y=n0,mark=square] {./data/lmp_feb_3_2010.dat};
	\addlegendentry{Day Ahead Prices}
 	\addplot+[opacity=.5, smooth,solid,color=blue,mark=o,line width=2pt] table[x=time, y=n1] {./data/lmp_feb_3_2010.dat};
	\addlegendentry{Real Time Prices}
\foreach \i in {2,...,15}
{
 	\addplot+[opacity=.25, smooth,solid,color=black,mark=o] table[x=time, y=n\i] {./data/lmp_feb_3_2010.dat};
%	\addlegendentryexpanded{$n\i$}
}

		\end{axis}	
		
		\begin{axis}[xlabel=$t$ (hour), ylabel=$Energy \hspace{4px}$ (MW)
				%,ybar stacked
				%,scale only axis
				, const plot
				, stack plots=y
				, area style
				,width=12cm
				, axis y line=right
				, axis x line=none
				,xmin=1,xmax=24 
				,ymin=0,ymax=30
				,legend style={
					area legend,
					at={(0.5,-0.15)},
					anchor=north,
					legend columns=-1}]

 	\addplot+[%solid,color=black,
			%pattern=flexible hatch,
			%pattern color = cyan
			opacity=.75
			] table[x=time, y=e_r] {feb_ex_leaf.dat} \closedcycle;
 	\addplot+[%color=red,
			%pattern=flexible hatch,
			%pattern color = red
			opacity=.75
			] table[x=time, y=s_r] {feb_ex_leaf.dat} \closedcycle;
 	\addplot+[%color=red,
			%pattern=flexible hatch,
			%pattern color = red
			opacity=.75
			] table[x=time, y=d_r] {feb_ex_leaf.dat} \closedcycle;
 	\addplot+[%color=red,
			%pattern=flexible hatch,
			%pattern color = red
			opacity=.75
			] table[x=time, y=t_r] {feb_ex_leaf.dat} \closedcycle;
	\legend{Energy Level, Energy Stored, Energy Dispatched, Travel Energy}
 %	\addplot+[ybar, solid,color=black,
%			pattern=flexible hatch,
%			pattern color = green] table[x=time, y=sr] {./feb_ex_modelS.dat};
%	\addplot+ table[x=time, y=n0] { feb_ex_modelS.dat};		

		\end{axis}


	\end{tikzpicture}
}



  \caption{Energy Storage Operation }
 \label{fig:eso}
\end{figure}